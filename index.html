async function main() {
  try {
    await liff.init({ liffId });

    if (!liff.isLoggedIn()) {
      document.getElementById("status").innerText = "กรุณาล็อกอินผ่าน LINE";
      document.getElementById("btnLogin").style.display = "inline-block";
      document.getElementById("btnLogin").onclick = () => liff.login();
    } else {
      const profile = await liff.getProfile();
      const userId = profile.userId;

      document.getElementById("status").innerText = `ยินดีต้อนรับ!`;

      fetch(scriptURL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ userId: userId }),
      })
      .then((res) => res.json())
      .then((data) => {
        if (data.status === "success") {
          window.location.href = redirectURL;
        } else {
          alert("เกิดข้อผิดพลาด: " + data.message);
        }
      })
      .catch((err) => {
        alert("ไม่สามารถส่งข้อมูลได้");
        console.error(err);
      });
    }
  } catch (error) {
    document.getElementById("status").innerText = "เกิดข้อผิดพลาดในการโหลด LIFF: " + error.message;
    console.error("LIFF init error:", error);
  }
}

<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE Login App</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background: linear-gradient(135deg, #fef6f9, #ffe8f1);
            min-height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(255, 182, 193, 0.2);
            text-align: center;
            max-width: 420px;
            width: 100%;
            border: 2px solid #ffd6e8;
        }
        
        .line-logo {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #ffd6e8, #ffb6cc);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            font-size: 45px;
            color: #5a2a4a;
            font-weight: bold;
            border: 3px solid #ffa6c9;
        }
        
        h1 {
            color: #5a2a4a;
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: 600;
        }
        
        .subtitle {
            color: #8a5a7a;
            margin-bottom: 30px;
            font-size: 1.1rem;
            font-weight: 400;
        }
        
        .login-btn {
            background: linear-gradient(135deg, #ffd6e8, #ffb6cc);
            color: #5a2a4a;
            border: 2px solid #ffa6c9;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            padding: 14px 40px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(255, 182, 193, 0.3);
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .login-btn:hover {
            background: linear-gradient(135deg, #ffb6cc, #ff96b8);
            border-color: #ff7fa3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 182, 193, 0.4);
        }
        
        .login-btn:disabled {
            background: #e6d7dd;
            color: #9d7d8d;
            cursor: not-allowed;
            transform: none;
            border-color: #d6c0c9;
        }
        
        .status {
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            font-size: 16px;
            font-weight: 500;
        }
        
        .status.success {
            background: linear-gradient(135deg, #d4f4dd, #c3e6cb);
            color: #2d5a34;
            border: 2px solid #b8e6c1;
        }
        
        .status.error {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #f1b0b7;
        }
        
        .status.loading {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border: 2px solid #a8dadc;
        }
        
        .user-info {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            text-align: left;
            border: 2px solid #e3d7e3;
        }
        
        .user-info h3 {
            margin-top: 0;
            color: #5a2a4a;
            font-weight: 600;
            font-size: 1.3rem;
        }
        
        .user-info p {
            margin: 10px 0;
            color: #8a5a7a;
            font-size: 16px;
            font-weight: 400;
        }
        
        .redirect-btn {
            background: linear-gradient(135deg, #c8b2db, #b19cd9);
            color: #5a2a4a;
            border: 2px solid #a687c7;
            border-radius: 15px;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
        }
        
        .redirect-btn:hover {
            background: linear-gradient(135deg, #b19cd9, #9f87d0);
            border-color: #8a6bb8;
            transform: translateY(-1px);
        }
        
        .config-note {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            font-size: 14px;
            text-align: left;
            border: 2px solid #f0d43a;
            font-weight: 400;
        }
        
        .emoji {
            font-size: 1.5em;
            margin: 0 5px;
        }
        
        .floating-hearts {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 2em;
            opacity: 0.6;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .sparkles {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 1.5em;
            opacity: 0.7;
            animation: sparkle 2s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="floating-hearts">üíï</div>
    <div class="sparkles">‚ú®</div>
    
    <div class="container">
        <div class="line-logo">üíö</div>
        <h1>üå∏ LINE Login üå∏</h1>
        <p class="subtitle">‚ú® ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á Canva üé®</p>
        
        <button id="loginBtn" class="login-btn" onclick="handleLogin()">
            üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ LINE
        </button>
        
        <div id="status"></div>
        <div id="userInfo"></div>
    </div>

    <script>
        // Configuration - ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const CONFIG = {
            LIFF_ID: '2007693716-B7D4wZow', // LIFF ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LINE Login
            GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzlcUI_6ndYKZd-G4u01ZfIrweeEVxBLjUKoZdaCiPkBYUImO0qo9hq6TNb6skKvkA/exec', // ‡πÉ‡∏™‡πà Google Apps Script URL
            CANVA_URL: 'https://mchlink.my.canva.site/notepreg', // URL ‡∏ó‡∏µ‡πà‡∏à‡∏∞ redirect ‡πÑ‡∏õ
            REDIRECT_DELAY: 3000 // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô redirect (‡∏°‡∏¥‡∏•‡∏•‡∏¥‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
        };

        let isLoggedIn = false;

        // Initialize LIFF
        async function initializeLIFF() {
            try {
                await liff.init({ liffId: CONFIG.LIFF_ID });
                
                if (liff.isLoggedIn()) {
                    isLoggedIn = true;
                    document.getElementById('loginBtn').innerHTML = 'üìä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
                    document.getElementById('loginBtn').disabled = true;
                    await handleUserData();
                } else {
                    showStatus('üéâ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö', 'success');
                }
            } catch (error) {
                console.error('LIFF initialization failed:', error);
                showStatus('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ: ' + error.message, 'error');
            }
        }

        // Handle login
        async function handleLogin() {
            if (isLoggedIn) {
                await handleUserData();
                return;
            }

            try {
                showStatus('üîê ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...', 'loading');
                document.getElementById('loginBtn').disabled = true;
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    await handleUserData();
                }
            } catch (error) {
                console.error('Login failed:', error);
                showStatus('‚ùå ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message, 'error');
                document.getElementById('loginBtn').disabled = false;
            }
        }

        // Handle user data after login
        async function handleUserData() {
            try {
                showStatus('üë§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...', 'loading');
                
                // Get user profile
                const profile = await liff.getProfile();
                const userData = {
                    userId: profile.userId,
                    displayName: profile.displayName,
                    pictureUrl: profile.pictureUrl,
                    statusMessage: profile.statusMessage,
                    timestamp: new Date().toISOString()
                };

                // Display user info
                displayUserInfo(userData);

                // Send to Google Sheets
                await sendToGoogleSheets(userData);

                // Redirect to Canva
                setTimeout(() => {
                    window.location.href = CONFIG.CANVA_URL;
                }, CONFIG.REDIRECT_DELAY);

            } catch (error) {
                console.error('Error handling user data:', error);
                showStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, 'error');
                document.getElementById('loginBtn').disabled = false;
            }
        }

        // Send data to Google Sheets
        async function sendToGoogleSheets(userData) {
            try {
                showStatus('üìä ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets...', 'loading');
                
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    showStatus('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Canva... üé®', 'success');
                } else {
                    throw new Error('HTTP ' + response.status);
                }
            } catch (error) {
                console.error('Error sending to Google Sheets:', error);
                showStatus('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, 'error');
                // Still redirect to Canva even if Google Sheets fails
                setTimeout(() => {
                    window.location.href = CONFIG.CANVA_URL;
                }, CONFIG.REDIRECT_DELAY);
            }
        }

        // Display user information
        function displayUserInfo(userData) {
            const userInfoDiv = document.getElementById('userInfo');
            userInfoDiv.innerHTML = `
                <div class="user-info">
                    <h3>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
                    <p><strong>üÜî User ID:</strong> ${userData.userId}</p>
                    <p><strong>üëã ‡∏ä‡∏∑‡πà‡∏≠:</strong> ${userData.displayName}</p>
                    ${userData.statusMessage ? `<p><strong>üí¨ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${userData.statusMessage}</p>` : ''}
                    <button class="redirect-btn" onclick="window.location.href='${CONFIG.CANVA_URL}'">
                        üé® ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Canva ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </button>
                </div>
            `;
        }

        // Show status messages
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // Initialize when page loads
        window.addEventListener('load', initializeLIFF);
    </script>
</body>
</html>
